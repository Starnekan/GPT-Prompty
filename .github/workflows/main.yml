name: ðŸ“„ Prompty â€“ peÅ‚na walidacja i styl

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  validate-prompts:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Checkout repo
      uses: actions/checkout@v3

    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: ðŸ“¦ Install dependencies
      run: |
        pip install markdown openai

    - name: âœ… Walidacja skÅ‚adni Markdown
      run: |
        find ./GPT-Prompty/prompt_templates -name "*.md" -exec python -m markdown {} \;

    - name: ðŸ” Sprawdzenie nagÅ‚Ã³wkÃ³w w plikach
      run: |
        for f in GPT-Prompty/prompt_templates/*.md; do
          grep -q "^# " "$f" || (echo "$f: brak nagÅ‚Ã³wka '#'" && exit 1)
          grep -qi "prompt" "$f" || (echo "$f: brak sÅ‚owa 'prompt'" && exit 1)
        done

    - name: ðŸ“‹ Sprawdzenie struktury promptu
      run: |
        for f in GPT-Prompty/prompt_templates/*.md; do
          grep -qi "opis" "$f" || echo "::warning file=$f::brak sekcji 'opis'"
          grep -qi "tagi" "$f" || echo "::warning file=$f::brak sekcji 'tagi'"
          grep -qi "uÅ¼ytkowanie" "$f" || echo "::warning file=$f::brak sekcji 'uÅ¼ytkowanie'"
        done

    - name: ðŸ§¾ Generowanie katalogu promptÃ³w
      run: |
        echo "# ðŸ“š Lista promptÃ³w" > GPT-Prompty/LISTA_PROMPTOW.md
        for f in GPT-Prompty/prompt_templates/*.md; do
          echo "- [$(basename "$f")]($f)" >> GPT-Prompty/LISTA_PROMPTOW.md
        done

        - name: ðŸ“¤ Upload wygenerowanego katalogu jako artefakt
      uses: actions/upload-artifact@v4
      with:
        name: prompt-listing
        path: GPT-Prompty/LISTA_PROMPTOW.md


